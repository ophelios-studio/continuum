[supervisord]
nodaemon=true

[program:postgres]
command=/bin/sh -lc 'if ! mountpoint -q /data; then echo "WARNING: /data is not a mounted Fly volume. Using ephemeral storage!"; fi; mkdir -p /data/pgdata && chown -R postgres:postgres /data && if [ ! -s /data/pgdata/PG_VERSION ]; then su -s /bin/sh -c "/usr/lib/postgresql/15/bin/initdb -D /data/pgdata" postgres; fi; exec su -s /bin/sh -c "/usr/lib/postgresql/15/bin/postgres -D /data/pgdata -c listen_addresses=localhost -p 5432" postgres'
autostart=true
autorestart=true
priority=10
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
user=root

[program:apache]
command=/usr/local/bin/apache2-foreground
autostart=true
autorestart=true
priority=20
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0